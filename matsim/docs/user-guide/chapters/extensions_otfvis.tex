\NextFile{OTFVis.html}
\section{OTFVis}

OTFVis  is a visualizer for MATSim. It can be used to replay snapshots of  simulations, or run a simulation and interact with it. The visualizer  makes use of hardware acceleration (OpenGL) and is thus also suitable  for visualizing large scenarios. If you have problems running OTFVis,  make sure to \href{http://www.matsim.org/docs/extensions/otfvis/opengl}{check your Graphics Card is able to support OTFVis}.

\subsubsection{Download / Requirements}

To use OTFVis, you need MATSim as well as the OTFVis extension. The  OTFVis extension is not yet available as an official release, so the  following documentation will use a nightly build of it.
\begin{itemize}
	\item Download a current nightly build of MATSim, the MATSim libraries and OTFVis from our \href{http://www.matsim.org/files/builds}{nightly build download page}.
	\item Unzip the MATSim libs
	\item Unzip the OTFVis Extension
\end{itemize}

You should now have: the MATSim jar, the libs directory, and the otfvis directory next to each other.

\subsubsection{Starting the Visualizer}

The main class for the visualizer is 
\texttt{org.matsim.contrib.otfvis.OTFVis}. The different ways to start OTFVis will be described in more details below.

The visualizer may require a lot of memory, it is thus advised to start it with the corresponding Java options, e.g. with 500MB:
\begin{verbatim}
java -Xmx500m-cp MATSim.jar:otfvis/otfvis.jarorg.matsim.contrib.otfvis.OTFVis arguments
\end{verbatim}

If you're on Windows, use 
\texttt{;} instead of 
\texttt{:} to  separate the jar files from each other. Also, depending on the version  you downloaded, you might have to adapt the file and directory names a  little bit.  

\subsubsection{Creating snapshots (mvi-files) from Events}

Use the following arguments:
\begin{verbatim}
-convert event-file network-file mvi-file [snapshot-period]
\end{verbatim}

to record a snapshot of all vehicles' positions every snapshot-period  seconds, based on the events and network given in the corresponding  files.

Example call:
\begin{verbatim}
java -cp MATSim.jar:otfvis/otfvis.jarorg.matsim.contrib.otfvis.OTFVis -convert output/50.events.txt.gz input/network.xml.gz output/50.visualization.mvi 300


\end{verbatim}

This will create a snapshot of every 5th minute and store it in the file 
\texttt{output/50.visualization.mvi}.

\subsubsection{Displaying MATSim Visualization Snapshots (mvi-files)}

Just pass the file as first argument. Example call:
\begin{verbatim}
java -cp MATSim.jar:otfvis/otfvis.jarorg.matsim.contrib.otfvis.OTFVis output/0.visualization.mvi
\end{verbatim}

\subsubsection{Displaying TRANSIMS Vehicle files}

For reasons of backward compatibility, OTFVis can display vehicles  files traditionally generated by TRANSIMS. As the vehicle file does not  include any network information, the network must be passed as well.  Example call:
\begin{verbatim}
java -cp MATSim.jar:otfvis/otfvis.jarorg.matsim.contrib.otfvis.OTFVis output/0.T.veh input/network.xml.gz
\end{verbatim}

\subsubsection{Displaying MATSim Network files}

OTFVis can display just a network. This is useful when building a  scenario, and a network converted from other data must be inspected.  Example call:
\begin{verbatim}
java -cp MATSim.jar:otfvis/otfvis.jarorg.matsim.contrib.otfvis.OTFVis input/network.xml.gz
\end{verbatim}

(Note: Currently only available in Nightly Builds since revision r5821)

\subsubsection{Start Interactive Simulation}

OTFVis can directly start a simulation and visualize it in real time.  As in that case, all data (esp. the population) is loaded into memory,  interactive queries about agents and link states can be issued from the  visualizer. To start OTFVis in this interactive, live mode, just pass it  the config-file you would otherwise pass to the Controler:
\begin{verbatim}
java -cp MATSim.jar:otfvis/otfvis.jar org.matsim.contrib.otfvis.OTFVis input/config.xml
\end{verbatim}

Please note that this will require even more resources (memory, cpu-speed) than only running the simulation with the Controler.

\subsubsection{Running OTFVis from within a windows systems}

As shown by the \href{http://www.matsim.org/downloads/nightly}{Nightly Builds}  tutorial OTFVis and other classes can be run by using the command line  or a shell script respectively. As the Unix based way is already  described by the tutorial, this is about the windows user.

The windows command line call looks similiar to the Unix based one. Finally, you should end with something like that
\begin{verbatim}
java -Xmx1500m -cp MATSim.jar:otfvis/otfvis.jarorg.matsim.contrib.otfvis.OTFVis %*
\end{verbatim}

which can be saved as a *.bat file, e.g. otfvis.bat. Please note that  the example is based on the assumption that otfvis.bat is saved in the  same folder as the matsim.jar and the libs folder. The placeholder \%*  will be substitued by the parameters you've specified when calling  otfvis.bat from the command line, e.g.
\begin{verbatim}
otfvis.bat -convert event-file network-file mvi-file
\end{verbatim}

To call the OTFVis from any folder, put the otfvis.bat into your PATH environment.

If your are more familiar with the point and click behaviour of win  systems, you can create a shortcut pointing to your otfvis.bat.
\begin{enumerate}

	\item By putting it on your desktop, you can drop any file on it, to call OTFVis with the file dropped, e.g. a network.

	\item 
Move  the shortcut to your SendTo folder and rename it to something like  OTFVis.lnk. Depending on the system you use, the SendTo folder should be  located in your home directory. Now you can start the OTFVis by  rightclicking at any file within your system, e.g. rightclick a  mvi-file, from the context menu select SendTo -$>$ OTFVis.

%\includegraphics{User%27s%20Guide_files/moz-screenshot.jpg}

\end{enumerate}



\vfill\eject
\section{OpenGL Requirements}

For  the hardware acceleration to work, (i) the OpenGL graphic card driver  installed on your machine must be at least of version 2.0 and (ii)  native libraries are required, which must be correctly set up.

\subsubsection{Check and Update Graphic Card Driver}

Either you use check and update mechanims / software already  installed (e.g. NVIDIA software, ATI update manager, etc...) or download  and install \href{http://www.realtech-vr.com/glview}{OpenGL Extension Viewer}.  After starting this little tool, it show all necessary information  abour your graphic card including OpenGL version. Please be sure that at  least \textbf{OpenGL version 2.0} is installed. Otherwise try  to find approriate driver updates of your graphic card (the read circles  in the Figure below shows the important featrues / information).


%\includegraphics{User%27s%20Guide_files/openglextensionviewer_png_4b5038ca1c.html}
