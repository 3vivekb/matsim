From d7b8bf5561b869a44f983bdf8f79b51ac5525ca7 Mon Sep 17 00:00:00 2001
From: Kai Nagel <2008@kainagel.org>
Date: Sat, 18 Jul 2015 13:48:34 +0200
Subject: [PATCH 05/16] towards a test of the randomized transit router

---
 .../RandomizedTransitRouterTest.java               |  40 +-
 .../common/randomizedtransitrouter/facilities.xml  |  14 -
 .../common/randomizedtransitrouter/kn100config.xml | 132 +++
 .../common/randomizedtransitrouter/knconfig.xml    | 161 ++++
 .../common/randomizedtransitrouter/network.xml     | 145 ++--
 .../common/randomizedtransitrouter/population.xml  | 904 +++++++++++++++++++++
 .../randomizedtransitrouter/transitVehicles.xml    | 116 ++-
 .../randomizedtransitrouter/transitschedule.xml    | 178 ++++
 .../signals/router/InvertedNetworkLegRouter.java   |   5 +-
 .../playground/kai/otfvis/TransitControler.java    |   1 -
 10 files changed, 1527 insertions(+), 169 deletions(-)
 delete mode 100644 contrib/common/test/input/org/matsim/contrib/common/randomizedtransitrouter/facilities.xml
 create mode 100644 contrib/common/test/input/org/matsim/contrib/common/randomizedtransitrouter/kn100config.xml
 create mode 100644 contrib/common/test/input/org/matsim/contrib/common/randomizedtransitrouter/knconfig.xml
 create mode 100644 contrib/common/test/input/org/matsim/contrib/common/randomizedtransitrouter/population.xml
 create mode 100644 contrib/common/test/input/org/matsim/contrib/common/randomizedtransitrouter/transitschedule.xml

diff --git a/contribs/common/src/test/java/org/matsim/contrib/common/randomizedtransitrouter/RandomizedTransitRouterTest.java b/contribs/common/src/test/java/org/matsim/contrib/common/randomizedtransitrouter/RandomizedTransitRouterTest.java
index 9848805..f15ccd6 100644
--- a/contribs/common/src/test/java/org/matsim/contrib/common/randomizedtransitrouter/RandomizedTransitRouterTest.java
+++ b/contribs/common/src/test/java/org/matsim/contrib/common/randomizedtransitrouter/RandomizedTransitRouterTest.java
@@ -18,12 +18,18 @@
  * *********************************************************************** */
 package org.matsim.contrib.common.randomizedtransitrouter;
 
+import org.junit.Ignore;
 import org.junit.Rule;
 import org.junit.Test;
 import org.matsim.api.core.v01.Scenario;
 import org.matsim.core.config.Config;
 import org.matsim.core.config.ConfigUtils;
+import org.matsim.core.config.groups.PlanCalcScoreConfigGroup.ActivityParams;
+import org.matsim.core.config.groups.StrategyConfigGroup.StrategySettings;
+import org.matsim.core.config.groups.VspExperimentalConfigGroup.VspDefaultsCheckingLevel;
 import org.matsim.core.controler.Controler;
+import org.matsim.core.replanning.DefaultPlanStrategiesModule.DefaultSelector;
+import org.matsim.core.replanning.DefaultPlanStrategiesModule.DefaultStrategy;
 import org.matsim.core.scenario.ScenarioUtils;
 import org.matsim.testcases.MatsimTestUtils;
 
@@ -36,15 +42,47 @@ public class RandomizedTransitRouterTest {
 	@Rule public MatsimTestUtils utils = new MatsimTestUtils() ;
 
 	@Test
+	@Ignore
 	public final void test() {
 		String scenarioDir = utils.getPackageInputDirectory() ;
 		String outputDir = utils.getOutputDirectory() ;
 
 		Config config = ConfigUtils.createConfig();
 		
+		config.network().setInputFile(scenarioDir + "/network.xml");
+		config.plans().setInputFile(scenarioDir + "/population.xml");
+
+		config.transit().setTransitScheduleFile(scenarioDir + "/transitschedule.xml");
+		config.transit().setVehiclesFile( scenarioDir + "/transitVehicles.xml" );
+		config.transit().setUseTransit(true);
+		
 		config.controler().setOutputDirectory( outputDir );
+		config.controler().setLastIteration(100);
+		{
+			ActivityParams params = new ActivityParams("home") ;
+			params.setTypicalDuration( 6*3600. );
+			config.planCalcScore().addActivityParams(params);
+		}
+		{
+			ActivityParams params = new ActivityParams("education_100") ;
+			params.setTypicalDuration( 6*3600. );
+			config.planCalcScore().addActivityParams(params);
+		}
+		{
+			StrategySettings stratSets = new StrategySettings(ConfigUtils.createAvailableStrategyId(config)) ;
+			stratSets.setStrategyName( DefaultStrategy.ReRoute.name() );
+			stratSets.setWeight(0.1);
+			config.strategy().addStrategySettings(stratSets);
+		}
+		{
+			StrategySettings stratSets = new StrategySettings(ConfigUtils.createAvailableStrategyId(config)) ;
+			stratSets.setStrategyName( DefaultSelector.ChangeExpBeta.name() );
+			stratSets.setWeight(0.9);
+			config.strategy().addStrategySettings(stratSets);
+		}
 		
-		config.transit().setUseTransit(true);
+		config.vspExperimental().setWritingOutputEvents(true);
+		config.vspExperimental().setVspDefaultsCheckingLevel( VspDefaultsCheckingLevel.warn );
 		
 		// ---
 		
diff --git a/contribs/common/test/input/org/matsim/contrib/common/randomizedtransitrouter/facilities.xml b/contribs/common/test/input/org/matsim/contrib/common/randomizedtransitrouter/facilities.xml
deleted file mode 100644
index d643709..0000000
--- a/contribs/common/test/input/org/matsim/contrib/common/randomizedtransitrouter/facilities.xml
+++ /dev/null
@@ -1,14 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<!DOCTYPE facilities SYSTEM "http://www.matsim.org/files/dtd/facilities_v1.dtd">
-<facilities>
-<facility id="100" y="5821600" x="4600333">
-<activity type="education_100">
-<opentime end_time="12:45:00" start_time="08:10:00" day="wkday"/>
-</activity>
-</facility>
-<facility id="1021" y="5800000" x="4600333">
-<activity type="home">
-<opentime end_time="24:00:00" start_time="00:00:00" day="wk"/>
-</activity>
-</facility>
-</facilities>
diff --git a/contribs/common/test/input/org/matsim/contrib/common/randomizedtransitrouter/kn100config.xml b/contribs/common/test/input/org/matsim/contrib/common/randomizedtransitrouter/kn100config.xml
new file mode 100644
index 0000000..84c09f0
--- /dev/null
+++ b/contribs/common/test/input/org/matsim/contrib/common/randomizedtransitrouter/kn100config.xml
@@ -0,0 +1,132 @@
+<?xml version="1.0" ?>
+<!DOCTYPE config SYSTEM "http://www.matsim.org/files/dtd/config_v1.dtd">
+<config>
+
+	<module name="global">
+		<param name="randomSeed" value="4711" />
+		<param name="coordinateSystem" value="gk3" />
+	</module>
+
+	<module name="network">
+		<param name="inputNetworkFile" value="Szenarien/SimplifiedRandomizedPT/network.xml" />
+	</module><!--
+	<module name="facilities">
+		<param name="inputFacilitiesFile" value="Szenarien/SimplifiedRandomizedPT/facilities.xml" />
+	</module>
+
+	--><module name="plans">
+		<param name="inputPlansFile" value="Szenarien/SimplifiedRandomizedPT/population.xml" />
+	</module>
+
+	<module name="transit">
+		<param name="transitScheduleFile" value="Szenarien/SimplifiedRandomizedPT/transitschedule.xml" />
+		<param name="vehiclesFile" value="Szenarien/SimplifiedRandomizedPT/transitVehicles.xml" />
+		<param name="transitModes" value="pt" />
+	</module>
+	
+
+	<module name="scenario">
+		<param name="useTransit" value="true" />
+		<param name="useVehicles" value="true" />
+	</module>
+	<module name="TimeAllocationMutator">
+	<param name="mutationRange" value="5400.0"/>
+	</module>
+
+	<module name="controler">
+		<param name="outputDirectory" value="Szenarien/SimplifiedRandomizedPT/knoutput" />
+		<param name="firstIteration" value="0" />
+		<param name="lastIteration" value="100" />
+		<param name="eventsFileFormat" value="xml" />
+		<param name="writeEventsInterval" value="1" />
+		<param name="writePlansInterval" value="50" />
+	</module>
+	
+	<module name="vspExperimental" >
+		<param name="isGeneratingBoardingDeniedEvent" value="true" />
+		<param name="isAbleToOverwritePtInteractionParams" value="true" />
+	</module>
+
+
+	<module name="qsim">
+		<!-- "start/endTime" of MobSim (00:00:00 == take earliest activity time/ run as long as active vehicles exist) -->
+		<param name="snapshotStyle" value="queue" />
+		<param name="startTime" value="07:00:00" />
+		<param name="endTime" value="18:00:00" />
+		<param name="snapshotperiod" value="00:00:00"/> 
+		<param name="removeStuckVehicles" value="false" />
+		<param name="vehicleBehavior" value="wait" />
+		<param name="flowCapacityFactor" value="1.0" />
+		<param name="storageCapacityFactor" value="1.0" />
+	</module>
+
+	<module name="planCalcScore">
+		<param name="learningRate" value="1.0" />
+		<param name="BrainExpBeta" value="2.0" />
+
+		<param name="lateArrival" value="-18" />
+		<param name="earlyDeparture" value="-18" />
+		<param name="performing" value="+6" />
+		<param name="traveling" value="-6" />
+		<param name="waiting" value="0" />
+		<param name="constantWalk" value="-0" />
+		<param name="marginalUtlOfDistanceWalk" value="0" />
+		<param name="utilityOfLineSwitch" value="-1" />
+		<param name="travelingWalk" value="-12" />
+		<param name="activityType_0"            value="home" /> <!-- home -->
+		<param name="activityPriority_0"        value="1" />
+		<param name="activityTypicalDuration_0" value="18:00:00" />
+	<!--	<param name="activityMinimalDuration_0" value="08:00:00" />-->
+		<param name="activityType_1" 			value="pt interaction" />
+		<param name="activityTypicalDuration_1" 	value="00:02:00" />
+	
+		<param name="activityType_2" value="education_100"/>
+		<param name="activityPriority_2" value="1"/>
+		<param name="activityTypicalDuration_2" value="05:25:00"/>
+		<param name="activityOpeningTime_2" value="08:10:00"/>
+		<param name="activityLatestStartTime_2" value="08:20:00"/>
+		<param name="activityEarliestEndTime_2" value="12:35:00"/>
+		<param name="activityClosingTime_2" value="12:45:00"/>
+
+
+		
+
+		</module>
+	
+	<module name="strategy">
+		<param name="maxAgentPlanMemorySize" value="5" /> <!-- 0 means unlimited -->
+
+		<param name="ModuleProbability_1" value="0.8" />
+		<!--param name="Module_1" value="ChangeExpBeta" /-->
+		<param name="Module_1" value="ChangeExpBeta" />
+
+		<param name="ModuleProbability_2" value="0.1" />
+		<param name="Module_2" value="ReRoute" />
+
+		<!--<param name="ModuleDisableAfterIteration_3" value="90" />-->
+		<!--<param name="ModuleProbability_3" value="0.1" />-->
+		<!--<param name="Module_3" value="TransitTimeAllocationMutator" />-->
+
+		<!--<param name="ModuleDisableAfterIteration_4" value="10" />-->
+		<!--<param name="ModuleProbability_4" value="0.9" />-->
+		<!--<param name="Module_4" value="TransitTimeAllocationMutator" />-->
+
+	</module>
+
+		<module name="transitRouter" >
+
+		<!-- additional time the router allocates when a line switch happens, Can be interpreted as a 'savity' time that agents need to savely transfer from one line to another -->
+		<param name="additionalTransferTime" value="0.0" />
+
+		<!-- step size to increase searchRadius if no stops are found -->
+		<param name="extensionRadius" value="1000.0" />
+
+		<!-- maximum beeline distance between stops that agents could transfer to by walking -->
+		<param name="maxBeelineWalkConnectionDistance" value="1500.0" />
+
+		<!-- the radius in which stop locations are searched, given a start or target coordinate -->
+		<param name="searchRadius" value="1000.0" />
+	</module>
+	
+
+</config>
diff --git a/contribs/common/test/input/org/matsim/contrib/common/randomizedtransitrouter/knconfig.xml b/contribs/common/test/input/org/matsim/contrib/common/randomizedtransitrouter/knconfig.xml
new file mode 100644
index 0000000..fe6037e
--- /dev/null
+++ b/contribs/common/test/input/org/matsim/contrib/common/randomizedtransitrouter/knconfig.xml
@@ -0,0 +1,161 @@
+<?xml version="1.0" ?>
+<!DOCTYPE config SYSTEM "http://www.matsim.org/files/dtd/config_v1.dtd">
+<config>
+
+	<module name="global">
+		<param name="randomSeed" value="4711" />
+		<param name="coordinateSystem" value="gk3" />
+	</module>
+
+	<module name="network">
+		<param name="inputNetworkFile" value="Szenarien/SimplifiedRandomizedPT/network.xml" />
+	</module><!--
+	<module name="facilities">
+		<param name="inputFacilitiesFile" value="Szenarien/SimplifiedRandomizedPT/facilities.xml" />
+	</module>
+
+	--><module name="plans">
+		<!--<param name="inputPlansFile" value="Szenarien/SimplifiedRandomizedPT/population.xml" />-->
+		<param name="inputPlansFile" value="Szenarien/SimplifiedRandomizedPT/knoutput/ITERS/it.100/100.plans.xml.gz" />
+	</module>
+
+	<module name="transit">
+		<param name="transitScheduleFile" value="Szenarien/SimplifiedRandomizedPT/transitschedule.xml" />
+		<param name="vehiclesFile" value="Szenarien/SimplifiedRandomizedPT/transitVehicles.xml" />
+		<param name="transitModes" value="pt" />
+	</module>
+	
+
+	<module name="scenario">
+		<param name="useTransit" value="true" />
+		<param name="useVehicles" value="true" />
+	</module>
+	<module name="TimeAllocationMutator">
+	<param name="mutationRange" value="5400.0"/>
+	</module>
+
+	<module name="controler">
+		<param name="outputDirectory" value="Szenarien/SimplifiedRandomizedPT/knoutput" />
+		<param name="firstIteration" value="0" />
+		<param name="lastIteration" value="100" />
+		<param name="eventsFileFormat" value="xml" />
+		<param name="writeEventsInterval" value="1" />
+		<param name="writePlansInterval" value="50" />
+		<param name="mobsim" value="qsim" />
+	</module>
+	
+	<module name="qsim">
+		<!-- "start/endTime" of MobSim (00:00:00 == take earliest activity time/ run as long as active vehicles exist) -->
+		<param name="snapshotStyle" value="queue" />
+		<param name="startTime" value="06:55:00" />
+		<param name="endTime" value="18:00:00" />
+		<param name="snapshotperiod" value="00:00:00"/> 
+		<param name="removeStuckVehicles" value="false" />
+		<param name="vehicleBehavior" value="wait" />
+		<param name="flowCapacityFactor" value="1.0" />
+		<param name="storageCapacityFactor" value="1.0" />
+	</module>
+
+	<module name="planCalcScore">
+		<param name="learningRate" value="1.0" />
+		<param name="BrainExpBeta" value="1.0" />
+
+		<param name="performing" value="+6" />
+		<!-- NOTE: any arrival before 8:10, i.e. most plans, will not accumulate any utl of performing-->
+
+<!--wenn alle gleichzeitig losgehen (7:01), und für alle die Aktivität gleichzeitig beginnt (8:10), dann gibt es -->
+<!--Differenzierung nur über in-veh, wait, walk, switch.-->
+
+<!--Nehmen wir erstmal an, dass in-veh=wait (alte Konvention): inveh=wait/walk/switch -->
+
+<!-- -1/-6/-6: Die meisten benutzen "direkt", manche benutzen "walk", niemand benutzt "switch".-->
+<!-- -6/-1/-6: Die meisten benutzen "walk", manche benutzen "direkt", niemand benutzt "switch". -->
+<!---6/-18/-0: ??-->
+		<param name="travelingPt" value="-6" />
+		<!--making in-veh time strongly negative penalizes the direct connection-->
+
+		<param name="travelingWalk" value="-18" />
+		<!--having walk at zero means walking is not worse than being early.  People walk all kinds of distances.-->
+
+		<param name="utilityOfLineSwitch" value="-0" />
+
+		<!--<param name="waitingPt" value="0" />-->
+		<!--the scoring of waiting does not work in the version A.Graf currently has.  Does it work without? -->
+
+		<param name="lateArrival" value="-18" />
+		<param name="waiting" value="0" />
+		<param name="earlyDeparture" value="-18" />
+		<param name="constantWalk" value="-0" />
+		<param name="marginalUtlOfDistanceWalk" value="0" />
+		<param name="activityType_0"            value="home" /> <!-- home -->
+		<param name="activityPriority_0"        value="1" />
+		<param name="activityTypicalDuration_0" value="18:00:00" />
+	<!--	<param name="activityMinimalDuration_0" value="08:00:00" />-->
+		<!--<param name="activityType_1" 			value="pt interaction" />-->
+		<!--<param name="activityTypicalDuration_1" 	value="00:02:00" />-->
+	
+		<param name="activityType_2" value="education_100"/>
+		<param name="activityPriority_2" value="1"/>
+		<param name="activityTypicalDuration_2" value="05:25:00"/>
+		<param name="activityOpeningTime_2" value="08:10:00"/>
+		<param name="activityLatestStartTime_2" value="08:20:00"/>
+		<param name="activityEarliestEndTime_2" value="12:35:00"/>
+		<param name="activityClosingTime_2" value="12:45:00"/>
+
+	</module>
+	
+	<module name="strategy">
+		<param name="maxAgentPlanMemorySize" value="5" /> <!-- 0 means unlimited -->
+
+		<param name="ModuleProbability_1" value="0.8" />
+		<param name="Module_1" value="ChangeExpBeta" />
+
+		<param name="ModuleProbability_2" value="0.1" />
+		<param name="Module_2" value="ReRoute" />
+
+		<!--<param name="ModuleDisableAfterIteration_3" value="90" />-->
+		<!--<param name="ModuleProbability_3" value="0.1" />-->
+		<!--<param name="Module_3" value="TransitTimeAllocationMutator" />-->
+
+		<!--<param name="ModuleDisableAfterIteration_4" value="10" />-->
+		<!--<param name="ModuleProbability_4" value="0.9" />-->
+		<!--<param name="Module_4" value="TransitTimeAllocationMutator" />-->
+
+	</module>
+
+		<module name="transitRouter" >
+
+		<!-- additional time the router allocates when a line switch happens, Can be interpreted as a 'savity' time that agents need to savely transfer from one line to another -->
+		<param name="additionalTransferTime" value="0.0" />
+
+		<!-- step size to increase searchRadius if no stops are found -->
+		<param name="extensionRadius" value="1000.0" />
+
+		<!-- maximum beeline distance between stops that agents could transfer to by walking -->
+		<param name="maxBeelineWalkConnectionDistance" value="1500.0" />
+
+		<!-- the radius in which stop locations are searched, given a start or target coordinate -->
+		<param name="searchRadius" value="1000.0" />
+	</module>
+	
+
+	<module name="TimeAllocationMutator">
+	  <param name="mutationRange" value="7200.0" />
+	</module>
+
+	<module name="vspExperimental">
+	  <param name="activityDurationInterpretation" value="tryEndTimeThenDuration" />
+	  <param name="removingUnnecessaryPlanAttributes" value="true" />
+	  <param name="isGeneratingBoardingDeniedEvent" value="true" />
+	</module>
+
+	<module name="otfvis" >
+		<!-- coloring scheme for otfvis.  Currently (2012) allowed values: standard bvg bvg2 byId -->
+		<!--<param name="coloringScheme" value="threeLinesTest" />-->
+
+		<!-- Shortens a link's start and end point in the visualization. -->
+		<param name="nodeOffset" value="0.1" />
+
+		<param name="showTeleportation" value="true" />
+	</module>
+</config>
diff --git a/contribs/common/test/input/org/matsim/contrib/common/randomizedtransitrouter/network.xml b/contribs/common/test/input/org/matsim/contrib/common/randomizedtransitrouter/network.xml
index 3264023..ff65cf0 100644
--- a/contribs/common/test/input/org/matsim/contrib/common/randomizedtransitrouter/network.xml
+++ b/contribs/common/test/input/org/matsim/contrib/common/randomizedtransitrouter/network.xml
@@ -1,90 +1,67 @@
 <?xml version="1.0" encoding="utf-8"?>
 <!DOCTYPE network SYSTEM "http://matsim.org/files/dtd/network_v1.dtd">
 <network>
-<nodes>
-<node x="4600000.0" y="5800000.0" id="1021"/>
-<node x="4600000.0" y="5799900.0" id="x1021"/>
-<node x="4600000.0" y="5800500.0" id="1121"/>
-<node x="4600000.0" y="5801000.0" id="1221"/>
-<node x="4600000.0" y="5801500.0" id="1321"/>
-<node x="4600000.0" y="5802000.0" id="1421"/>
-<node x="4600000.0" y="5802500.0" id="1521"/>
-<node x="4600333.0" y="5800500.0" id="1124"/>
-<node x="4600333.0" y="5801000.0" id="1224"/>
-<node x="4600333.0" y="5801500.0" id="1324"/>
-<node x="4600333.0" y="5802000.0" id="1424"/>
-<node x="4600333.0" y="5802500.0" id="1524"/>
-<node x="4600374.0" y="5800497.0" id="2124"/>
-<node x="4600416.0" y="5800994.0" id="2224"/>
-<node x="4600457.0" y="5801491.0" id="2324"/>
-<node x="4600498.0" y="5801988.0" id="2424"/>
-<node x="4600539.0" y="5802485.0" id="2524"/>
-<node x="4600959.0" y="5811297.0" id="1125"/>
-<node x="4600918.0" y="5811794.0" id="1225"/>
-<node x="4600000.0" y="5821600.0" id="1022"/>
-<node x="4600000.0" y="5821700.0" id="x1022"/>
-<node x="4600333.3" y="5800000.0" id="1024"/>
-<node x="4600333.3" y="5799900.0" id="x1024"/>
-<node x="4601000.0" y="5810800.0" id="1025"/>
-<node x="4601100.0" y="5810800.0" id="x1025"/>
-<node x="4600333.3" y="5821600.0" id="1026"/>
-<node x="4600333.3" y="5821700.0" id="x1026"/>
-</nodes>
-<links capperiod="10:00:00">
-<!--"fast":-->
-<link id="6"   modes="pt" permlanes="1" capacity="2000" freespeed="111" length="19100" to="1022" from="1521"/>
-<link id="106" modes="pt" permlanes="1" capacity="2000" freespeed="111" length="19100" to="1521" from="1022"/>
+	<nodes>
+		<node x="4600000.0" y="5799750.0" id="821" />
+		<node x="4600000.0" y="5799975.0" id="921" />
+		<node x="4600000.0" y="5800000.0" id="1021" />
+		<node x="4600000.0" y="5821850.0" id="822" />
+		<node x="4600000.0" y="5821625.0" id="922" />
+		<node x="4600000.0" y="5821600.0" id="1022" />
+		<node x="4600333.3" y="5799750.0" id="824" />
+		<node x="4600333.3" y="5799975.0" id="924" />
+		<node x="4600333.3" y="5800000.0" id="1024" />
+		<node x="4601250.0" y="5810800.0" id="825" />
+		<node x="4601025.0" y="5810800.0" id="925" />
+		<node x="4601000.0" y="5810800.0" id="1025" />
+		<node x="4600333.3" y="5821850.0" id="826" />
+		<node x="4600333.3" y="5821625.0" id="926" />
+		<node x="4600333.3" y="5821600.0" id="1026" />
+	</nodes>
+	<links capperiod="10:00:00">
+		<link id="102102" modes="pt" permlanes="1" capacity="2000"
+			freespeed="22" length="25" to="921" from="821" />
+		<link id="102101" modes="pt" permlanes="1" capacity="2000"
+			freespeed="22" length="25" to="1021" from="921" />
+		<link id="21" modes="pt" permlanes="1" capacity="2000" freespeed="9.23"
+			length="21600" to="1026" from="1024" />
+		<link id="102402" modes="pt" permlanes="1" capacity="2000"
+			freespeed="22" length="25" to="924" from="824" />
+		<link id="102401" modes="pt" permlanes="1" capacity="2000"
+			freespeed="22" length="25" to="1024" from="924" />
+		<link id="102412" modes="pt" permlanes="1" capacity="2000"
+			freespeed="22" length="25" to="824" from="924" />
+		<link id="102411" modes="pt" permlanes="1" capacity="2000"
+			freespeed="22" length="25" to="924" from="1024" />
+		<link id="102502" modes="pt" permlanes="1" capacity="2000"
+			freespeed="22" length="25" to="925" from="825" />
+		<link id="102501" modes="pt" permlanes="1" capacity="2000"
+			freespeed="22" length="25" to="1025" from="925" />
+		<link id="102512" modes="pt" permlanes="1" capacity="2000"
+			freespeed="22" length="25" to="825" from="925" />
+		<link id="102511" modes="pt" permlanes="1" capacity="2000"
+			freespeed="22" length="25" to="925" from="1025" />
+		<link id="11" modes="pt" permlanes="1" capacity="2000" freespeed="22.5"
+			length="21600" to="1022" from="1021" />
+		<link id="102212" modes="pt" permlanes="1" capacity="2000"
+			freespeed="22" length="25" to="822" from="922" />
+		<link id="102211" modes="pt" permlanes="1" capacity="2000"
+			freespeed="22" length="25" to="922" from="1022" />
+		<link id="22" modes="pt" permlanes="1" capacity="2000" freespeed="36"
+			length="21600" to="1024" from="1026" />
+		<link id="102602" modes="pt" permlanes="1" capacity="2000"
+			freespeed="22" length="25" to="926" from="826" />
+		<link id="102601" modes="pt" permlanes="1" capacity="2000"
+			freespeed="22" length="25" to="1026" from="926" />
+		<link id="102612" modes="pt" permlanes="1" capacity="2000"
+			freespeed="22" length="25" to="826" from="926" />
+		<link id="102611" modes="pt" permlanes="1" capacity="2000"
+			freespeed="22" length="25" to="926" from="1026" />
+		<link id="31" modes="pt" permlanes="1" capacity="2000" freespeed="13.9"
+			length="10846" to="1025" from="1024" />
+		<link id="41" modes="pt" permlanes="1" capacity="2000" freespeed="13.9"
+			length="10846" to="1026" from="1025" />
 
-<!--"direct":-->
-<link id="12" modes="pt" permlanes="1" capacity="2000" freespeed="15" length="19100" to="1026" from="1524"/>
-<link id="112" modes="pt" permlanes="1" capacity="2000" freespeed="15" length="19100" to="1524" from="1026"/>
 
-<!--"switch" (second long link):-->
-<link id="21"  modes="pt" permlanes="1" capacity="2000" freespeed="23" length="9846" to="1026" from="1225"/>
-<link id="121" modes="pt" permlanes="1" capacity="2000" freespeed="23" length="9846" to="1225" from="1026"/>
-
-<link id="1" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="1121" from="1021"/>
-<link id="2" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="1221" from="1121"/>
-<link id="3" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="1321" from="1221"/>
-<link id="4" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="1421" from="1321"/>
-<link id="5" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="1521" from="1421"/>
-<link id="7" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="1124" from="1024"/>
-<link id="8" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="1224" from="1124"/>
-<link id="9" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="1324" from="1224"/>
-<link id="10" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="1424" from="1324"/>
-<link id="11" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="1524" from="1424"/>
-<link id="13" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="2124" from="1024"/>
-<link id="14" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="2224" from="2124"/>
-<link id="15" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="2324" from="2224"/>
-<link id="16" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="2424" from="2324"/>
-<link id="17" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="2524" from="2424"/>
-<link id="18" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="8346" to="1025" from="2524"/>
-<link id="19" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="1125" from="1025"/>
-<link id="20" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="1225" from="1125"/>
-<link id="101" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="1021" from="1121"/>
-<link id="102" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="1121" from="1221"/>
-<link id="103" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="1221" from="1321"/>
-<link id="104" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="1321" from="1421"/>
-<link id="105" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="1421" from="1521"/>
-<link id="107" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="1024" from="1124"/>
-<link id="108" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="1124" from="1224"/>
-<link id="109" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="1224" from="1324"/>
-<link id="110" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="1324" from="1424"/>
-<link id="111" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="1424" from="1524"/>
-<link id="113" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="1024" from="2124"/>
-<link id="114" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="2124" from="2224"/>
-<link id="115" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="2224" from="2324"/>
-<link id="116" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="2324" from="2424"/>
-<link id="117" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="2424" from="2524"/>
-<link id="118" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="8346" to="2524" from="1025"/>
-<link id="119" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="1025" from="1125"/>
-<link id="120" modes="pt" permlanes="1" capacity="2000" freespeed="22" length="500" to="1125" from="1225"/>
-
-<link id="1000" modes="pt" permlanes="1" capacity="2000" freespeed="12" length="100" to="1021" from="x1021"/>
-<link id="2000" modes="pt" permlanes="1" capacity="2000" freespeed="12" length="100" to="1024" from="x1024"/>
-<link id="4000" modes="pt" permlanes="1" capacity="2000" freespeed="12" length="100" to="1025" from="x1025"/>
-<link id="1100" modes="pt" permlanes="1" capacity="2000" freespeed="12" length="100" to="1022" from="x1022"/>
-<link id="2100" modes="pt" permlanes="1" capacity="2000" freespeed="12" length="100" to="1026" from="x1026"/>
-
-</links>
+	</links>
 </network>
diff --git a/contribs/common/test/input/org/matsim/contrib/common/randomizedtransitrouter/population.xml b/contribs/common/test/input/org/matsim/contrib/common/randomizedtransitrouter/population.xml
new file mode 100644
index 0000000..1ea0468
--- /dev/null
+++ b/contribs/common/test/input/org/matsim/contrib/common/randomizedtransitrouter/population.xml
@@ -0,0 +1,904 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!DOCTYPE plans SYSTEM "http://www.matsim.org/files/dtd/plans_v4.dtd">
+<plans>
+	<person employed="no" age="12" id="1">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="2">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="3">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="4">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="5">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="6">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="7">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="8">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="9">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="10">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="11">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="12">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="13">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="14">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="15">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="16">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="17">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="18">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="19">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="20">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="21">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="22">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="23">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="24">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="25">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="26">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="27">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="28">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="29">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="30">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="31">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="32">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="33">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="34">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="35">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="36">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="37">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="38">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="39">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="40">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="41">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="42">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="43">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="44">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="45">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="46">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="47">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="48">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="49">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="50">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="51">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="52">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="53">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="54">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="55">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="56">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="57">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="58">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="59">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="60">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="61">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="62">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="63">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="64">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="65">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="66">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="67">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="68">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="69">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="70">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="71">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="72">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="73">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="74">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="75">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="76">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="77">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="78">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="79">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="80">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="81">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="82">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="83">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="84">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="85">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="86">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="87">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="88">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="89">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="90">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="91">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="92">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="93">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="94">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="95">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="96">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="97">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="98">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="99">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+	<person employed="no" age="12" id="100">
+		<plan selected="yes">
+			<act end_time="07:16:00" y="5800000" x="4600333" type="home" />
+			<leg mode="pt" />
+			<act end_time="12:35:00" y="5821600" x="4600333" type="education_100" />
+			<leg mode="pt" />
+			<act y="5800000" x="4600333" type="home" />
+		</plan>
+	</person>
+</plans>
diff --git a/contribs/common/test/input/org/matsim/contrib/common/randomizedtransitrouter/transitVehicles.xml b/contribs/common/test/input/org/matsim/contrib/common/randomizedtransitrouter/transitVehicles.xml
index d11d0cf..caeee93 100644
--- a/contribs/common/test/input/org/matsim/contrib/common/randomizedtransitrouter/transitVehicles.xml
+++ b/contribs/common/test/input/org/matsim/contrib/common/randomizedtransitrouter/transitVehicles.xml
@@ -1,69 +1,51 @@
 <?xml version="1.0" encoding="UTF-8"?>
-<vehicleDefinitions xmlns="http://www.matsim.org/files/dtd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.matsim.org/files/dtd http://www.matsim.org/files/dtd/vehicleDefinitions_v1.0.xsd">
-<vehicleType id="1">
-<description>pt</description>
-<capacity>
-<seats persons="50"/>
-<standingRoom persons="100"/>
-</capacity>
-<length meter="12"/>
-</vehicleType>
-<vehicle id="1000" type="1"/>
-<vehicle id="1003" type="1"/>
-<vehicle id="1006" type="1"/>
-<vehicle id="1009" type="1"/>
-<vehicle id="1009b" type="1"/>
-<vehicle id="1009c" type="1"/>
-<vehicle id="1012" type="1"/>
-<vehicle id="1015" type="1"/>
-<vehicle id="1018" type="1"/>
-<vehicle id="2000" type="1"/>
-<vehicle id="2003" type="1"/>
-<vehicle id="2006" type="1"/>
-<vehicle id="2009" type="1"/>
-<vehicle id="2012" type="1"/>
-<vehicle id="2015" type="1"/>
-<vehicle id="2018" type="1"/>
-<vehicle id="3000" type="1"/>
-<vehicle id="3003" type="1"/>
-<vehicle id="3006" type="1"/>
-<vehicle id="3009" type="1"/>
-<vehicle id="3012" type="1"/>
-<vehicle id="3015" type="1"/>
-<vehicle id="3018" type="1"/>
-<vehicle id="4000" type="1"/>
-<vehicle id="4003" type="1"/>
-<vehicle id="4006" type="1"/>
-<vehicle id="4009" type="1"/>
-<vehicle id="4012" type="1"/>
-<vehicle id="4015" type="1"/>
-<vehicle id="4018" type="1"/>
-<vehicle id="1100" type="1"/>
-<vehicle id="1103" type="1"/>
-<vehicle id="1106" type="1"/>
-<vehicle id="1109" type="1"/>
-<vehicle id="1112" type="1"/>
-<vehicle id="1115" type="1"/>
-<vehicle id="1118" type="1"/>
-<vehicle id="2100" type="1"/>
-<vehicle id="2103" type="1"/>
-<vehicle id="2106" type="1"/>
-<vehicle id="2109" type="1"/>
-<vehicle id="2112" type="1"/>
-<vehicle id="2115" type="1"/>
-<vehicle id="2118" type="1"/>
-<vehicle id="3100" type="1"/>
-<vehicle id="3103" type="1"/>
-<vehicle id="3106" type="1"/>
-<vehicle id="3109" type="1"/>
-<vehicle id="3112" type="1"/>
-<vehicle id="3115" type="1"/>
-<vehicle id="3118" type="1"/>
-<vehicle id="4100" type="1"/>
-<vehicle id="4103" type="1"/>
-<vehicle id="4106" type="1"/>
-<vehicle id="4109" type="1"/>
-<vehicle id="4112" type="1"/>
-<vehicle id="4115" type="1"/>
-<vehicle id="4118" type="1"/>
+<vehicleDefinitions xmlns="http://www.matsim.org/files/dtd"
+	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+	xsi:schemaLocation="http://www.matsim.org/files/dtd http://www.matsim.org/files/dtd/vehicleDefinitions_v1.0.xsd">
+	<vehicleType id="1">
+		<description>pt</description>
+		<capacity>
+			<seats persons="35" />
+			<standingRoom persons="0" />
+		</capacity>
+		<length meter="12" />
+	</vehicleType>
+	<vehicleType id="2">
+		<description>pt</description>
+		<capacity>
+			<seats persons="200" />
+			<standingRoom persons="0" />
+		</capacity>
+		<length meter="30" />
+	</vehicleType>
+	<vehicle id="1000" type="1" />
+	<vehicle id="1003" type="1" />
+	<vehicle id="1006" type="1" />
+	<vehicle id="1009" type="1" />
+	<vehicle id="1012" type="1" />
+	<vehicle id="1015" type="1" />
+	<vehicle id="1018" type="1" />
+	<vehicle id="2000" type="1" />
+	<vehicle id="2003" type="1" />
+	<vehicle id="2006" type="1" />
+	<vehicle id="2009" type="1" />
+	<vehicle id="2012" type="1" />
+	<vehicle id="2015" type="1" />
+	<vehicle id="2018" type="1" />
+	<vehicle id="3000" type="1" />
+	<vehicle id="3003" type="1" />
+	<vehicle id="3006" type="1" />
+	<vehicle id="3009" type="1" />
+	<vehicle id="3012" type="1" />
+	<vehicle id="3015" type="1" />
+	<vehicle id="3018" type="1" />
+	<vehicle id="4000" type="1" />
+	<vehicle id="4003" type="1" />
+	<vehicle id="4006" type="1" />
+	<vehicle id="4009" type="1" />
+	<vehicle id="4012" type="1" />
+	<vehicle id="4015" type="1" />
+	<vehicle id="4018" type="1" />
+	<vehicle id="2001" type="2" />
+
 </vehicleDefinitions>
diff --git a/contribs/common/test/input/org/matsim/contrib/common/randomizedtransitrouter/transitschedule.xml b/contribs/common/test/input/org/matsim/contrib/common/randomizedtransitrouter/transitschedule.xml
new file mode 100644
index 0000000..5cd814d
--- /dev/null
+++ b/contribs/common/test/input/org/matsim/contrib/common/randomizedtransitrouter/transitschedule.xml
@@ -0,0 +1,178 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE transitSchedule SYSTEM "http://www.matsim.org/files/dtd/transitSchedule_v1.dtd">
+<transitSchedule>
+	<transitStops>
+		<stopFacility id="1021000001" x="4600000.0" y="5800000.0"
+			linkRefId="102101" />
+		<stopFacility id="1022000001" x="4600000.0" y="5821600.0"
+			linkRefId="102211" />
+		<stopFacility id="1024000001" x="4600333.0" y="5800000.0"
+			linkRefId="102401" />
+		<stopFacility id="1026000001" x="4600333.0" y="5821600.0"
+			linkRefId="102611" />
+		<stopFacility id="1025000001" x="4601000.0" y="5810800.0"
+			linkRefId="102511" />
+		<stopFacility id="1026000002" x="4600333.0" y="5821600.0"
+			linkRefId="102601" />
+		<stopFacility id="1024000002" x="4600333.0" y="5800000.0"
+			linkRefId="102411" />
+		<stopFacility id="1025000002" x="4601000.0" y="5810800.0"
+			linkRefId="102501" />
+	</transitStops>
+	<transitLine id="gelb">
+		<transitRoute id="gelb_1">
+			<transportMode>pt</transportMode>
+			<routeProfile>
+				<stop refId="1021000001" departureOffset="00:01:00"
+					arrivalOffset="00:00:00" awaitDeparture="true" />
+				<stop refId="1022000001" departureOffset="00:17:00"
+					arrivalOffset="00:17:00" awaitDeparture="true" />
+			</routeProfile>
+			<route>
+				<link refId="102102" />
+				<link refId="102101" />
+				<link refId="11" />
+				<link refId="102211" />
+				<link refId="102212" />
+			</route>
+			<departures>
+				<departure id="1000" departureTime="06:08:39"
+					vehicleRefId="1000" />
+				<departure id="1003" departureTime="06:38:39"
+					vehicleRefId="1003" />
+				<departure id="1006" departureTime="07:08:39"
+					vehicleRefId="1006" />
+				<departure id="1009" departureTime="07:38:39"
+					vehicleRefId="1009" />
+				<departure id="1012" departureTime="08:08:39"
+					vehicleRefId="1012" />
+				<departure id="1015" departureTime="08:38:39"
+					vehicleRefId="1015" />
+				<departure id="1018" departureTime="09:08:39"
+					vehicleRefId="1018" />
+			</departures>
+		</transitRoute>
+	</transitLine>
+	<transitLine id="blau">
+		<transitRoute id="blau_1">
+			<transportMode>pt</transportMode>
+			<routeProfile>
+				<stop refId="1024000001" departureOffset="00:01:00"
+					arrivalOffset="00:00:00" awaitDeparture="true" />
+				<stop refId="1026000001" departureOffset="00:40:00"
+					arrivalOffset="00:40:00" awaitDeparture="true" />
+			</routeProfile>
+			<route>
+				<link refId="102402" />
+				<link refId="102401" />
+				<link refId="21" />
+				<link refId="102611" />
+				<link refId="102612" />
+			</route>
+			<departures>
+				<departure id="2000" departureTime="06:00:00"
+					vehicleRefId="2000" />
+				<departure id="2003" departureTime="06:30:00"
+					vehicleRefId="2003" />
+				<departure id="2006" departureTime="07:00:00"
+					vehicleRefId="2006" />
+				<departure id="2009" departureTime="07:30:00"
+					vehicleRefId="2009" />
+				<departure id="2012" departureTime="08:00:00"
+					vehicleRefId="2012" />
+				<departure id="2015" departureTime="08:30:00"
+					vehicleRefId="2015" />
+				<departure id="2018" departureTime="09:00:00"
+					vehicleRefId="2018" />
+			</departures>
+		</transitRoute>
+		<transitRoute id="blau_2">
+			<transportMode>pt</transportMode>
+			<routeProfile>
+				<stop refId="1026000002" departureOffset="00:01:00"
+					arrivalOffset="00:00:00" awaitDeparture="true" />
+				<stop refId="1024000002" departureOffset="00:11:00"
+					arrivalOffset="00:02:00" awaitDeparture="true" />
+			</routeProfile>
+			<route>
+				<link refId="102602" />
+				<link refId="102601" />
+				<link refId="22" />
+				<link refId="102411" />
+				<link refId="102412" />
+			</route>
+			<departures>
+				<departure id="2001" departureTime="12:46:00"
+					vehicleRefId="2001" />
+			</departures>
+		</transitRoute>
+	</transitLine>
+	<transitLine id="grün">
+		<transitRoute id="grün_1">
+			<transportMode>pt</transportMode>
+			<routeProfile>
+				<stop refId="1024000001" departureOffset="00:01:00"
+					arrivalOffset="00:00:00" awaitDeparture="true" />
+				<stop refId="1025000001" departureOffset="00:14:00"
+					arrivalOffset="00:14:00" awaitDeparture="true" />
+			</routeProfile>
+			<route>
+				<link refId="102402" />
+				<link refId="102401" />
+				<link refId="31" />
+				<link refId="102511" />
+				<link refId="102512" />
+			</route>
+			<departures>
+				<departure id="3000" departureTime="06:00:00"
+					vehicleRefId="3000" />
+				<departure id="3003" departureTime="06:30:00"
+					vehicleRefId="3003" />
+				<departure id="3006" departureTime="07:00:00"
+					vehicleRefId="3006" />
+				<departure id="3009" departureTime="07:30:00"
+					vehicleRefId="3009" />
+				<departure id="3012" departureTime="08:00:00"
+					vehicleRefId="3012" />
+				<departure id="3015" departureTime="08:30:00"
+					vehicleRefId="3015" />
+				<departure id="3018" departureTime="09:00:00"
+					vehicleRefId="3018" />
+			</departures>
+		</transitRoute>
+	</transitLine>
+	<transitLine id="rot">
+		<transitRoute id="rot_1">
+			<transportMode>pt</transportMode>
+			<routeProfile>
+				<stop refId="1025000002" departureOffset="00:00:00"
+					arrivalOffset="00:00:00" awaitDeparture="true" />
+				<stop refId="1026000001" departureOffset="00:14:00"
+					arrivalOffset="00:14:00" awaitDeparture="true" />
+			</routeProfile>
+			<route>
+				<link refId="102502" />
+				<link refId="102501" />
+				<link refId="41" />
+				<link refId="102611" />
+				<link refId="102612" />
+			</route>
+			<departures>
+				<departure id="4000" departureTime="06:16:00"
+					vehicleRefId="4000" />
+				<departure id="4003" departureTime="06:46:00"
+					vehicleRefId="4003" />
+				<departure id="4006" departureTime="07:16:00"
+					vehicleRefId="4006" />
+				<departure id="4009" departureTime="07:46:00"
+					vehicleRefId="4009" />
+				<departure id="4012" departureTime="08:16:00"
+					vehicleRefId="4012" />
+				<departure id="4015" departureTime="08:46:00"
+					vehicleRefId="4015" />
+				<departure id="4018" departureTime="09:16:00"
+					vehicleRefId="4018" />
+			</departures>
+		</transitRoute>
+	</transitLine>
+</transitSchedule>
diff --git a/contribs/signals/src/main/java/org/matsim/contrib/signals/router/InvertedNetworkLegRouter.java b/contribs/signals/src/main/java/org/matsim/contrib/signals/router/InvertedNetworkLegRouter.java
index 8360f65..a09cb02 100644
--- a/contribs/signals/src/main/java/org/matsim/contrib/signals/router/InvertedNetworkLegRouter.java
+++ b/contribs/signals/src/main/java/org/matsim/contrib/signals/router/InvertedNetworkLegRouter.java
@@ -76,9 +76,10 @@ public class InvertedNetworkLegRouter implements LegRouter {
 		
 		this.invertedNetwork = new NetworkInverter(network, allowedInLinkTurnInfoMap).getInvertedNetwork();
 
-		// method that takes a getLinkTravelTime( link , ...) with a link from the inverted network, converts it into links on the 
-		// original network, and looks up the link2link tttime in the l2ltravelTimes data structure:
+		// convert l2ltravelTimes into something that can be used by the inverted network router:
 		TravelTimesInvertedNetProxy travelTimesProxy = new TravelTimesInvertedNetProxy(network, l2ltravelTimes);
+		// (method that takes a getLinkTravelTime( link , ...) with a link from the inverted network, converts it into links on the 
+		// original network, and looks up the link2link tttime in the l2ltravelTimes data structure)
 		
 		TravelDisutility travelCost = travelCostCalculatorFactory.createTravelDisutility(
 				travelTimesProxy, cnScoringGroup);
diff --git a/playgrounds/kai/src/main/java/playground/kai/otfvis/TransitControler.java b/playgrounds/kai/src/main/java/playground/kai/otfvis/TransitControler.java
index d77b758..9c745ba 100644
--- a/playgrounds/kai/src/main/java/playground/kai/otfvis/TransitControler.java
+++ b/playgrounds/kai/src/main/java/playground/kai/otfvis/TransitControler.java
@@ -57,7 +57,6 @@ public class TransitControler {
 		new ConfigReader(config).readFile(args[0]);
 		if ( useTransit ) {
 			config.transit().setUseTransit(true);
-			config.scenario().setUseVehicles(true);
 //		config.otfVis().setColoringScheme( OTFVisConfigGroup.COLORING_BVG ) ;
 		}
 
-- 
2.3.2 (Apple Git-55)

